<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="FastDFS 搭建分布式文件管理系统 FastDFS 简介 FastDFS 是一个开源的高性能分布式文件系统（Distributed File System）。它的主要功能包括：文件存储、文件同步和文件访问以及高容量和负载平衡。主要解决了海量数据存储问题，特别适合以中小文件（建议范围：4KB < file_size < 500MB）为载体的在线服务。\n"><title>FastDFS 搭建分布式文件管理系统</title><link rel=canonical href=https://jinggqu.github.io/posts/getting-to-know-fastdfs/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="FastDFS 搭建分布式文件管理系统"><meta property='og:description' content="FastDFS 搭建分布式文件管理系统 FastDFS 简介 FastDFS 是一个开源的高性能分布式文件系统（Distributed File System）。它的主要功能包括：文件存储、文件同步和文件访问以及高容量和负载平衡。主要解决了海量数据存储问题，特别适合以中小文件（建议范围：4KB < file_size < 500MB）为载体的在线服务。\n"><meta property='og:url' content='https://jinggqu.github.io/posts/getting-to-know-fastdfs/'><meta property='og:site_name' content="Anthony's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2020-11-04T17:00:00+08:00'><meta property='article:modified_time' content='2020-11-04T17:00:00+08:00'><meta name=twitter:title content="FastDFS 搭建分布式文件管理系统"><meta name=twitter:description content="FastDFS 搭建分布式文件管理系统 FastDFS 简介 FastDFS 是一个开源的高性能分布式文件系统（Distributed File System）。它的主要功能包括：文件存储、文件同步和文件访问以及高容量和负载平衡。主要解决了海量数据存储问题，特别适合以中小文件（建议范围：4KB < file_size < 500MB）为载体的在线服务。\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_fd6b132a83bc2f5d.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Anthony's blog</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=https://github.com/jinggqu target=_blank><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
<span>GitHub</span></a></li><li><a href=https://unsplash.com/@xvyn target=_blank><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Unsplash</span></a></li><li><a href=/index.xml target=_blank><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg>
<span>RSS</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#fastdfs-简介>FastDFS 简介</a><ol><li><a href=#fastdfs-架构图>FastDFS 架构图</a></li><li><a href=#fastdfs-上传流程>FastDFS 上传流程</a></li><li><a href=#fastdfs-下载流程>FastDFS 下载流程</a></li></ol></li><li><a href=#安装-fastdfs>安装 FastDFS</a><ol><li><a href=#配置防火墙>配置防火墙</a></li><li><a href=#下载安装-libfastcommon>下载安装 libfastcommon</a></li><li><a href=#下载安装-fastdfs>下载安装 FastDFS</a></li></ol></li><li><a href=#配置-fastdfs-tracker-服务>配置 FastDFS Tracker 服务</a><ol><li><a href=#修改配置文件>修改配置文件</a></li><li><a href=#启动-tracker-服务>启动 Tracker 服务</a></li></ol></li><li><a href=#配置-fastdfs-storage-服务>配置 FastDFS Storage 服务</a><ol><li><a href=#修改配置文件-1>修改配置文件</a></li><li><a href=#启动-storage-服务>启动 Storage 服务</a></li></ol></li><li><a href=#文件上传测试>文件上传测试</a><ol><li><a href=#修改配置文件-2>修改配置文件</a></li><li><a href=#上传图片测试>上传图片测试</a></li></ol></li><li><a href=#配置-nginx>配置 Nginx</a><ol><li><a href=#修改配置>修改配置</a></li></ol></li><li><a href=#配置-fastdfs-nginx-module-模块>配置 fastdfs-nginx-module 模块</a><ol><li><a href=#模块简介>模块简介</a></li><li><a href=#下载解压>下载解压</a></li><li><a href=#为-nginx-添加模块>为 Nginx 添加模块</a></li><li><a href=#修改-nginx-配置>修改 Nginx 配置</a></li><li><a href=#修改-fastdfs-nginx-module-配置>修改 fastdfs-nginx-module 配置</a></li><li><a href=#测试>测试</a></li></ol></li><li><a href=#参考文章>参考文章</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/fastdfs/>Fastdfs</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/getting-to-know-fastdfs/>FastDFS 搭建分布式文件管理系统</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 04, 2020</time></div></footer></div></header><section class=article-content><h1 id=fastdfs-搭建分布式文件管理系统>FastDFS 搭建分布式文件管理系统</h1><h2 id=fastdfs-简介>FastDFS 简介</h2><p>FastDFS 是一个开源的高性能分布式文件系统（Distributed File System）。它的主要功能包括：文件存储、文件同步和文件访问以及高容量和负载平衡。主要解决了海量数据存储问题，特别适合以中小文件（建议范围：4KB &lt; file_size &lt; 500MB）为载体的在线服务。</p><p>FastDFS 开源地址：https://github.com/happyfish100/fastdfs</p><p>由于网络上已有很多详细的关于 FastDFS 的介绍，故此处不再赘述。请查看参考文章中的第 1、2 条。</p><h3 id=fastdfs-架构图>FastDFS 架构图</h3><p><img src=/posts/getting-to-know-fastdfs/assets/20201103150000.webp width=872 height=843 srcset="/posts/getting-to-know-fastdfs/assets/20201103150000_hu_7ad6992491982d2b.webp 480w, /posts/getting-to-know-fastdfs/assets/20201103150000_hu_c80c8c382a96040b.webp 1024w" loading=lazy alt="FastDFS 分布式文件系统架构图" class=gallery-image data-flex-grow=103 data-flex-basis=248px></p><h3 id=fastdfs-上传流程>FastDFS 上传流程</h3><p><img src=/posts/getting-to-know-fastdfs/assets/20201104100033.webp width=1881 height=1299 srcset="/posts/getting-to-know-fastdfs/assets/20201104100033_hu_d2ad4f8b27ec4008.webp 480w, /posts/getting-to-know-fastdfs/assets/20201104100033_hu_d00781fddb166861.webp 1024w" loading=lazy alt="FastDFS 文件上传流程示意图" class=gallery-image data-flex-grow=144 data-flex-basis=347px></p><h3 id=fastdfs-下载流程>FastDFS 下载流程</h3><p><img src=/posts/getting-to-know-fastdfs/assets/20201104100107.webp width=1753 height=1156 srcset="/posts/getting-to-know-fastdfs/assets/20201104100107_hu_7f3c4c5b356d833d.webp 480w, /posts/getting-to-know-fastdfs/assets/20201104100107_hu_5a37e48e13d8b6e.webp 1024w" loading=lazy alt="FastDFS 文件下载流程示意图" class=gallery-image data-flex-grow=151 data-flex-basis=363px></p><h2 id=安装-fastdfs>安装 FastDFS</h2><h3 id=配置防火墙>配置防火墙</h3><p>本篇文章是基于 CentOS v8.2.2004 版本，以下操作均为单机环境，单机 IP 地址为 192.168.61.128。在安装 FastDFS 之前，需要先进行防火墙的设置。防火墙的相关命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## 暂时关闭防火墙</span>
</span></span><span class=line><span class=cl>systemctl stop firewalld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 永久关闭防火墙</span>
</span></span><span class=line><span class=cl>systemctl disable firewalld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 启用防火墙</span>
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> firewalld
</span></span></code></pre></td></tr></table></div></div><h3 id=下载安装-libfastcommon>下载安装 libfastcommon</h3><p>libfastcommon 是从 FastDFS 抽取出来的公共 c 函数库。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## 下载</span>
</span></span><span class=line><span class=cl>wget https://github.com/happyfish100/libfastcommon/archive/V1.0.43.tar.gz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 解压</span>
</span></span><span class=line><span class=cl>tar -zxvf V1.0.43.tar.gz
</span></span><span class=line><span class=cl><span class=nb>cd</span> libfastcommon-1.0.43
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 编译安装</span>
</span></span><span class=line><span class=cl>./make.sh
</span></span><span class=line><span class=cl>./make.sh install
</span></span></code></pre></td></tr></table></div></div><p>libfastcommon.so 安装到了 <code>/usr/lib64/libfastcommon.so</code>，但是 FastDFS 主程序设置的 lib 目录是 <code>/usr/local/lib</code>，所以需要创建软链接。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so
</span></span><span class=line><span class=cl>ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so
</span></span><span class=line><span class=cl>ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so
</span></span><span class=line><span class=cl>ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so
</span></span></code></pre></td></tr></table></div></div><h3 id=下载安装-fastdfs>下载安装 FastDFS</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## 下载</span>
</span></span><span class=line><span class=cl>wget https://github.com/happyfish100/fastdfs/archive/V6.06.tar.gz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 解压</span>
</span></span><span class=line><span class=cl>tar -zxvf V6.06.tar.gz
</span></span><span class=line><span class=cl><span class=nb>cd</span> fastdfs-6.06
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 编译安装</span>
</span></span><span class=line><span class=cl>./make.sh
</span></span><span class=line><span class=cl>./make.sh install
</span></span></code></pre></td></tr></table></div></div><p>安装完成之后，服务脚本存储在 <code>/etc/init.d/</code> 中，详细文件如下：</p><pre><code>/etc/init.d/fdfs_storaged
/etc/init.d/fdfs_tracker
</code></pre><p>默认配置文件存储在 <code>/etc/fdfs/</code> 中，详细文件如下：</p><pre><code>/etc/fdfs/client.conf.sample
/etc/fdfs/storage.conf.sample
/etc/fdfs/tracker.conf.sample
</code></pre><p>命令工具存储在 <code>/usr/bin/</code> 中，详细文件如下：</p><pre><code>fdfs_appender_test
fdfs_appender_test1
fdfs_append_file
fdfs_crc32
fdfs_delete_file
fdfs_download_file
fdfs_file_info
fdfs_monitor
fdfs_regenerate_filename
fdfs_storaged
fdfs_test
fdfs_test1
fdfs_trackerd
fdfs_upload_appender
fdfs_upload_file
stop.sh
restart.sh
</code></pre><h2 id=配置-fastdfs-tracker-服务>配置 FastDFS Tracker 服务</h2><h3 id=修改配置文件>修改配置文件</h3><p>从上文可知，配置文件在 <code>/etc/fdfs/</code> 中，我们需要拷贝一份并进行一些修改。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /etc/fdfs
</span></span><span class=line><span class=cl>cp tracker.conf.sample tracker.conf
</span></span><span class=line><span class=cl>vim tracker.conf
</span></span></code></pre></td></tr></table></div></div><p>需要修改的部分如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>## Tracker 数据和日志存储目录
</span></span><span class=line><span class=cl>base_path = /home/fastdfs/tracker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## HTTP 服务端口
</span></span><span class=line><span class=cl>http.server_port = 80
</span></span></code></pre></td></tr></table></div></div><p>根据上述配置，创建配置中的目录</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p /home/fastdfs/tracker
</span></span></code></pre></td></tr></table></div></div><h3 id=启动-tracker-服务>启动 Tracker 服务</h3><p>初次成功启动，会在 base_path 即 <code>/home/fastdfs/tracker</code> 下创建 data、logs 两个目录。启动命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/etc/init.d/fdfs_trackerd start
</span></span><span class=line><span class=cl><span class=c1>## 或</span>
</span></span><span class=line><span class=cl>service fdfs_trackerd start
</span></span></code></pre></td></tr></table></div></div><p>启动后，可以通过 netstat 命令查看是都启动成功，若得到以下类似输出，22122 端口处于监听状态，则表示 Tracker 服务安装并启动成功。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>netstat -unltp <span class=p>|</span> grep fdfs
</span></span></code></pre></td></tr></table></div></div><pre><code>## 输出内容
tcp        0      0 0.0.0.0:22122           0.0.0.0:*               LISTEN      6220/fdfs_trackerd
</code></pre><p>同理，可以通过下列命令关闭 Tracker 服务或者设置 Tracker 开机自启：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## 关闭服务</span>
</span></span><span class=line><span class=cl>service fdfs_trackerd stop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 开机自启</span>
</span></span><span class=line><span class=cl>chkconfig fdfs_trackerd on
</span></span></code></pre></td></tr></table></div></div><h2 id=配置-fastdfs-storage-服务>配置 FastDFS Storage 服务</h2><h3 id=修改配置文件-1>修改配置文件</h3><p>与配置 Tracker 服务类似，首先我们也需要拷贝样例配置文件并进行相应修改。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /etc/fdfs
</span></span><span class=line><span class=cl>cp storage.conf.sample storage.conf
</span></span><span class=line><span class=cl>vim storage.conf
</span></span></code></pre></td></tr></table></div></div><p>需要修改的部分如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>## Tracker 数据和日志存储目录
</span></span><span class=line><span class=cl>base_path = /home/fastdfs/storage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 存放文件时 storage server 支持多个路径。这里配置存放文件的基路径数目，通常只配一个目录
</span></span><span class=line><span class=cl>store_path_count=1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 逐一配置 store_path_count 个路径，索引号基于 0
</span></span><span class=line><span class=cl>## 如果不配置 store_path0，那它就和 base_path 对应的路径一样
</span></span><span class=line><span class=cl>store_path0=/home/fastdfs/file
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## FastDFS 存储文件时，采用了两级目录。这里配置存放文件的目录个数。
</span></span><span class=line><span class=cl>## 如果本参数为 N（默认 256），那么 storage server 在初次运行时，会在 store_path 下自动创建 N*N 个存放文件的子目录
</span></span><span class=line><span class=cl>subdir_count_per_path=256
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## tracker_server 的列表 ，会主动连接 tracker_server
</span></span><span class=line><span class=cl>## 有多个 tracker server 时，每个 tracker server 写一行
</span></span><span class=line><span class=cl>tracker_server=192.168.61.128:22122
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## HTTP 服务端口
</span></span><span class=line><span class=cl>http.server_port = 80
</span></span></code></pre></td></tr></table></div></div><p>根据上述配置，创建配置中的目录</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## base_path</span>
</span></span><span class=line><span class=cl>mkdir -p /home/fastdfs/storage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## store_path0</span>
</span></span><span class=line><span class=cl>mkdir -p /home/fastdfs/file
</span></span></code></pre></td></tr></table></div></div><h3 id=启动-storage-服务>启动 Storage 服务</h3><p>启动 Storage 前确保 Tracker 是启动的。初次启动成功，会在 base_path 即 <code>/home/fastdfs/storage/</code> 目录下创建 data、logs 两个目录。启动命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/etc/init.d/fdfs_storaged start
</span></span><span class=line><span class=cl><span class=c1>## 或</span>
</span></span><span class=line><span class=cl>service fdfs_storaged start
</span></span></code></pre></td></tr></table></div></div><p>启动后，可以通过下列命令查看 Storage 服务是否启动成功。若输出结果与下列输出类似，23000 端口正处于监听状态，则 Storage 服务启动成功。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>netstat -unltp <span class=p>|</span> grep fdfs
</span></span></code></pre></td></tr></table></div></div><pre><code>## 输出内容
tcp        0      0 0.0.0.0:23000           0.0.0.0:*               LISTEN      6257/fdfs_storaged
tcp        0      0 0.0.0.0:22122           0.0.0.0:*               LISTEN      6220/fdfs_trackerd
</code></pre><p>同理，可以通过下列命令关闭 Tracker 服务或者设置 Tracker 开机自启：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## 关闭服务</span>
</span></span><span class=line><span class=cl>service fdfs_storaged stop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 开机自启</span>
</span></span><span class=line><span class=cl>chkconfig fdfs_storaged on
</span></span></code></pre></td></tr></table></div></div><p>此时我们可以在 store_path0 目录下看到 Storage 服务自动创建的 N*N 个子目录</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ls /home/fastdfs/file/data/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 统计文件夹数量</span>
</span></span><span class=line><span class=cl>ls -l <span class=p>|</span> grep <span class=s2>&#34;^d&#34;</span> <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=m>00</span>
</span></span><span class=line><span class=cl>ls -l <span class=p>|</span> grep <span class=s2>&#34;^d&#34;</span> <span class=p>|</span> wc -l
</span></span></code></pre></td></tr></table></div></div><pre><code>## 输出内容
00  0A  14  1E  28  32  3C  46  50  5A  64  6E  78  82  8C  96  A0  AA  B4  BE  C8  D2  DC  E6  F0  FA
01  0B  15  1F  29  33  3D  47  51  5B  65  6F  79  83  8D  97  A1  AB  B5  BF  C9  D3  DD  E7  F1  FB
02  0C  16  20  2A  34  3E  48  52  5C  66  70  7A  84  8E  98  A2  AC  B6  C0  CA  D4  DE  E8  F2  FC
03  0D  17  21  2B  35  3F  49  53  5D  67  71  7B  85  8F  99  A3  AD  B7  C1  CB  D5  DF  E9  F3  FD
04  0E  18  22  2C  36  40  4A  54  5E  68  72  7C  86  90  9A  A4  AE  B8  C2  CC  D6  E0  EA  F4  FE
05  0F  19  23  2D  37  41  4B  55  5F  69  73  7D  87  91  9B  A5  AF  B9  C3  CD  D7  E1  EB  F5  FF
06  10  1A  24  2E  38  42  4C  56  60  6A  74  7E  88  92  9C  A6  B0  BA  C4  CE  D8  E2  EC  F6
07  11  1B  25  2F  39  43  4D  57  61  6B  75  7F  89  93  9D  A7  B1  BB  C5  CF  D9  E3  ED  F7
08  12  1C  26  30  3A  44  4E  58  62  6C  76  80  8A  94  9E  A8  B2  BC  C6  D0  DA  E4  EE  F8
09  13  1D  27  31  3B  45  4F  59  63  6D  77  81  8B  95  9F  A9  B3  BD  C7  D1  DB  E5  EF  F9

256

256
</code></pre><h2 id=文件上传测试>文件上传测试</h2><h3 id=修改配置文件-2>修改配置文件</h3><p>与配置 Storage 服务类似，首先我们也需要拷贝客户端样例配置文件并进行相应修改。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /etc/fdfs
</span></span><span class=line><span class=cl>cp client.conf.sample client.conf
</span></span><span class=line><span class=cl>vim client.conf
</span></span></code></pre></td></tr></table></div></div><p>需要修改的部分如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>## Client 的数据和日志目录
</span></span><span class=line><span class=cl>base_path=/home/fastdfs/client
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## Tracker端口
</span></span><span class=line><span class=cl>tracker_server=192.168.61.128:22122
</span></span></code></pre></td></tr></table></div></div><h3 id=上传图片测试>上传图片测试</h3><p>执行下列命令，尝试上传一张图片到 FastDFS 中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fdfs_upload_file /home/Pictures/1989.jpg
</span></span></code></pre></td></tr></table></div></div><p>上传成功后，会输出文件 ID：group1/M00/00/00/wKg9gF-f0aKAUJAlAARra4mLMhc390.jpg</p><p>返回的文件 ID 由 group、存储目录、两级子目录、fileid、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。</p><p><img src=/posts/getting-to-know-fastdfs/assets/20201104093640.webp width=1871 height=370 srcset="/posts/getting-to-know-fastdfs/assets/20201104093640_hu_f495d00f677cff2f.webp 480w, /posts/getting-to-know-fastdfs/assets/20201104093640_hu_b84d793ffe1123a.webp 1024w" loading=lazy alt="FastDFS 文件 ID 结构示例" class=gallery-image data-flex-grow=505 data-flex-basis=1213px></p><h2 id=配置-nginx>配置 Nginx</h2><p>安装 Nginx 的相关操作请查看文章 <a class=link href=https://jinggqu.github.io/posts/getting-to-know-nginx/ target=_blank rel=noopener>初识 Nginx</a>，此处不再赘述。</p><h3 id=修改配置>修改配置</h3><p>经过上述操作之后，文件已经可以通过命令行的方式上传到 FastDFS 中，但还无法下载，此时我们需要使用 Nginx 来实现下载功能。修改 Nginx 配置文件，在 server 组内添加以下内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>server {
</span></span><span class=line><span class=cl>    listen       80;
</span></span><span class=line><span class=cl>    server_name  localhost;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ## 添加以下部分
</span></span><span class=line><span class=cl>    location /group1/M00 {
</span></span><span class=line><span class=cl>        alias /home/fastdfs/file/data;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>然后重启 Nginx，访问服务器 ip/fileid 进行测试，根据上述例子，此处访问 http://192.168.61.128/group1/M00/00/00/wKg9gF-f0aKAUJAlAARra4mLMhc390.jpg</p><p>测试结果如下图，可以看到已经访问成功，HTTP 状态码返回 200。</p><p><img src=/posts/getting-to-know-fastdfs/assets/20201104104028.webp width=1829 height=1003 srcset="/posts/getting-to-know-fastdfs/assets/20201104104028_hu_2c97bcde8334dcdf.webp 480w, /posts/getting-to-know-fastdfs/assets/20201104104028_hu_bc347f83632b978a.webp 1024w" loading=lazy alt="FastDFS 文件访问测试结果" class=gallery-image data-flex-grow=182 data-flex-basis=437px></p><h2 id=配置-fastdfs-nginx-module-模块>配置 fastdfs-nginx-module 模块</h2><h3 id=模块简介>模块简介</h3><p>fastdfs-nginx-module 可以重定向文件链接到源服务器，避免由于 Storage 服务器复制延迟导致文件无法访问而产生的错误。</p><h3 id=下载解压>下载解压</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://github.com/happyfish100/fastdfs-nginx-module/archive/V1.22.tar.gz
</span></span><span class=line><span class=cl>tar -zxvf V1.22.tar.gz
</span></span><span class=line><span class=cl><span class=nb>cd</span> fastdfs-nginx-module
</span></span></code></pre></td></tr></table></div></div><h3 id=为-nginx-添加模块>为 Nginx 添加模块</h3><p>首先进入 Nginx 源目录，然后执行 <code>./configure</code> 命令，具体命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nginx -s stop
</span></span><span class=line><span class=cl><span class=nb>cd</span> /usr/local/software/nginx-1.18.0
</span></span><span class=line><span class=cl>./configure --prefix<span class=o>=</span>/usr/local/nginx/ --add-module<span class=o>=</span><span class=nv>$YOUR_PATH</span>/fastdfs-nginx-module/src
</span></span><span class=line><span class=cl>make <span class=o>&amp;&amp;</span> make install
</span></span></code></pre></td></tr></table></div></div><p>其中，<code>/usr/local/software/nginx-1.18.0</code> 为 Nginx 源目录，<code>--prefix</code> 参数指定新版本生成的目录，<code>--add-module</code> 参数表示添加模块，<code>$YOUR_PATH</code> 需要手动替换为 fastdfs-nginx-module 模块的文件路径，本例中为 <code>/usr/local/software/fastdfs-nginx-module</code>。</p><p>安装好之后可以通过以下命令查看 Nginx 模块，如果输出与下列内容类似，则表示模块添加成功。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nginx -V
</span></span></code></pre></td></tr></table></div></div><pre><code>## 输出内容
nginx version: nginx/1.18.0
built by gcc 8.3.1 20191121 (Red Hat 8.3.1-5) (GCC)
configure arguments: --prefix=/usr/local/nginx/ --add-module=/usr/local/software/fastdfs-nginx-module/src
</code></pre><h3 id=修改-nginx-配置>修改 Nginx 配置</h3><p>修改 nginx.conf，在 server 中做出如下修改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>server {
</span></span><span class=line><span class=cl>    listen       80;
</span></span><span class=line><span class=cl>    server_name  localhost;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ## 删除以下部分
</span></span><span class=line><span class=cl>    location /group1/M00 {
</span></span><span class=line><span class=cl>        alias /home/fastdfs/file/data;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ## 添加以下部分
</span></span><span class=line><span class=cl>    location ~/group[0-9]/ {
</span></span><span class=line><span class=cl>        ngx_fastdfs_module;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=修改-fastdfs-nginx-module-配置>修改 fastdfs-nginx-module 配置</h3><p>复制 fastdfs-nginx-module 源码中的配置文件到 <code>/etc/fdfs</code> 目录，兵做以下修改。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /usr/local/software/fastdfs-nginx-module/src
</span></span><span class=line><span class=cl>cp mod_fastdfs.conf /etc/fdfs/
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>## Tracker Server
</span></span><span class=line><span class=cl>tracker_server=192.168.61.128:22122
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## Storage Server 默认端口
</span></span><span class=line><span class=cl>storage_server_port=23000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 如果文件 ID 的 uri 中包含 /group**，则要设置为 true
</span></span><span class=line><span class=cl>url_have_group_name = true
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## Storage 配置的 store_path0 路径，必须和 storage.conf 中的一致
</span></span><span class=line><span class=cl>store_path0=/home/fastdfs/file
</span></span></code></pre></td></tr></table></div></div><p>复制 FastDFS 的部分配置文件到 <code>/etc/fdfs</code> 目录</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /usr/local/software/fastdfs-5.05/conf/
</span></span><span class=line><span class=cl>cp anti-steal.jpg http.conf mime.types /etc/fdfs/
</span></span></code></pre></td></tr></table></div></div><h3 id=测试>测试</h3><p>配置完成之后，我们先启动 Nginx 服务，并观察输出内容，如果与下列输出类似，则表示配置成功。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nginx
</span></span></code></pre></td></tr></table></div></div><pre><code>## 输出内容
ngx_http_fastdfs_set pid=11648
</code></pre><p>此时我们可以在浏览器中访问前文中上传的文件，能下载文件则表示 fastdfs-nginx-module 模块安装成功。注意和和前文中直接使用 Nginx 路由访问不同的是，这里配置 fastdfs-nginx-module 模块，可以重定向文件链接到源服务器取文件。访问结果如下图所示。</p><p><img src=/posts/getting-to-know-fastdfs/assets/20201104104028.webp width=1829 height=1003 srcset="/posts/getting-to-know-fastdfs/assets/20201104104028_hu_2c97bcde8334dcdf.webp 480w, /posts/getting-to-know-fastdfs/assets/20201104104028_hu_bc347f83632b978a.webp 1024w" loading=lazy alt="FastDFS 通过 Nginx 模块访问文件测试" class=gallery-image data-flex-grow=182 data-flex-basis=437px></p><p>至此，FastDFS 搭建分布式文件管理系统就初步完成了，在下一篇文章中，将介绍如何在客户端上通过 Java 来实现文件的上传和下载。</p><h2 id=参考文章>参考文章</h2><ol><li><a class=link href=https://www.cnblogs.com/chiangchou/p/fastdfs.html target=_blank rel=noopener>用 FastDFS 一步步搭建文件管理系统</a></li><li><a class=link href=https://www.cnblogs.com/myitnews/p/12214319.html target=_blank rel=noopener>FastDFS 简介</a></li><li><a class=link href=https://programmer.ink/think/fastdfs-distributed-file-storage.html target=_blank rel=noopener>FastDFS Distributed File Storage</a></li><li><a class=link href="http://bbs.chinaunix.net/forum.php?mod=viewthread&amp;tid=1941456" target=_blank rel=noopener>FastDFS 配置文件详解（修订版 1）</a></li><li><a class=link href=https://jinggqu.github.io/posts/getting-to-know-nginx/ target=_blank rel=noopener>初识 Nginx</a></li><li><a class=link href=https://github.com/happyfish100/fastdfs-nginx-module/blob/master/INSTALL target=_blank rel=noopener>fastdfs nginx module installation introduction</a></li></ol></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><script src=https://giscus.app/client.js data-repo=jinggqu/jinggqu.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxNDkyMTI2MDk=" data-category=Announcements data-category-id=DIC_kwDOCOTNwc4Ca4Al data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2025 Anthony's blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>